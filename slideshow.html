<!DOCTYPE html>
<html>
<head>
  <title>ChurchPP 슬라이드쇼</title>
  <style>
    body { 
      margin: 0; 
      padding: 0; 
      background: black; 
      color: white; 
      font-family: Arial; 
      overflow: hidden; 
    }
    .slideshow-container { 
      position: relative; 
      width: 100vw; 
      height: 100vh; 
      display: flex; 
      align-items: center; 
      justify-content: center; 
    }
    .slide { 
      display: none; 
      width: 100%; 
      height: 100%; 
      position: absolute; 
      top: 0; 
      left: 0; 
    }
    .slide.active { 
      display: flex; 
      align-items: center; 
      justify-content: center; 
    }
    .slide img { 
      max-width: 100%; 
      max-height: 100%; 
      object-fit: contain; 
    }
    .controls { 
      position: fixed; 
      bottom: 20px; 
      right: 20px; 
      z-index: 1000; 
      opacity: 0.8; 
    }
    .controls button { 
      margin: 5px; 
      padding: 10px 15px; 
      background: rgba(0,0,0,0.7); 
      color: white; 
      border: 1px solid #333; 
      border-radius: 5px; 
      cursor: pointer; 
    }
    .controls button:hover { 
      background: rgba(0,0,0,0.9); 
    }
    .slide-counter { 
      position: fixed; 
      top: 20px; 
      left: 20px; 
      background: rgba(0,0,0,0.7); 
      color: white; 
      padding: 10px 15px; 
      border-radius: 5px; 
      z-index: 1000; 
    }
  </style>
</head>
<body>
  <div class="slide-counter" id="counter">1 / 1</div>
  <div class="slideshow-container">
    <!-- Slides will be dynamically inserted here -->
  </div>
  
  <div class="controls">
    <button onclick="toggleFullscreen()">전체화면</button>
    <button onclick="prevSlide()">이전</button>
    <button onclick="nextSlide()">다음</button>
    <button onclick="window.close()">닫기</button>
  </div>

  <script>
    let currentSlide = 0;
    let slides = [];
    
    function initSlideshow(slideData) {
      slides = slideData;
      const container = document.querySelector('.slideshow-container');
      const counter = document.getElementById('counter');
      
      // Clear existing slides
      container.innerHTML = '';
      
      // Create slide elements
      slides.forEach((slide, index) => {
        const slideDiv = document.createElement('div');
        slideDiv.className = 'slide';
        if (index === 0) slideDiv.classList.add('active');
        
        if (slide.type === 'image') {
          slideDiv.innerHTML = `<img src="${slide.data}" alt="${slide.name}">`;
        }
        
        container.appendChild(slideDiv);
      });
      
      updateCounter();
    }
    
    // Check if parent window has slide data
    window.addEventListener('load', function() {
      if (window.opener && window.opener.slideshowData) {
        initSlideshow(window.opener.slideshowData);
      }
    });
    
    function nextSlide() {
      if (slides.length === 0) return;
      
      const current = document.querySelector('.slide.active');
      current.classList.remove('active');
      
      currentSlide = (currentSlide + 1) % slides.length;
      
      const next = document.querySelectorAll('.slide')[currentSlide];
      next.classList.add('active');
      
      updateCounter();
    }
    
    function prevSlide() {
      if (slides.length === 0) return;
      
      const current = document.querySelector('.slide.active');
      current.classList.remove('active');
      
      currentSlide = (currentSlide - 1 + slides.length) % slides.length;
      
      const prev = document.querySelectorAll('.slide')[currentSlide];
      prev.classList.add('active');
      
      updateCounter();
    }
    
    function updateCounter() {
      const counter = document.getElementById('counter');
      counter.textContent = `${currentSlide + 1} / ${slides.length}`;
    }
    
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        document.documentElement.requestFullscreen().catch(err => {
          console.log(`Error attempting to enable fullscreen: ${err.message}`);
        });
      } else {
        document.exitFullscreen();
      }
    }
    
    // Keyboard navigation
    document.addEventListener('keydown', function(e) {
      if (e.key === 'ArrowRight' || e.key === ' ') { 
        e.preventDefault(); 
        nextSlide(); 
      }
      if (e.key === 'ArrowLeft') { 
        e.preventDefault(); 
        prevSlide(); 
      }
      if (e.key === 'Escape') { 
        if (document.fullscreenElement) 
          document.exitFullscreen(); 
        else 
          window.close(); 
      }
      if (e.key === 'f' || e.key === 'F') { 
        toggleFullscreen(); 
      }
    });
    
    // Click navigation (except on controls)
    document.addEventListener('click', function(e) {
      if (!e.target.closest('.controls')) {
        nextSlide();
      }
    });
  </script>
</body>
</html>